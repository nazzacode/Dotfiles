;; $DOOMDIR/config.el -*- lexical-binding: t; -*-

;; Here are some additional functions/macros that could help you configure Doom:
;;
;; - `load!' for loading external *.el files relative to this one
;; - `use-package!' for configuring packages
;; - `after!' for running code after a package has loaded
;; - `add-load-path!' for adding directories to the `load-path', relative to
;;   this file. Emacs searches the `load-path' when you load packages with
;;   `require' or `use-package'.
;; - `map!' for binding new keys
;;
;; To get information about any of these functions/macros, move the cursor over
;; the highlighted symbol at press 'K' (non-evil users must press 'C-c c k').
;; This will open documentation for it, including demos of how they are used.
;;
;; You can also try 'gd' (or 'C-c c d') to jump to their definition and see how
;; they are implemented.
(setq my-name "Nazza")

;; `doom-font` and 'variable-pitch' are the important ones!
(setq doom-font (font-spec :family "Agave Nerd Font Mono")
      doom-variable-pitch-font (font-spec :family "Overpass")  ; inherits `doom-font''s :size
;;      doom-unicode-font (font-spec :family "Input Mono Narrow" :size 12)
;;      doom-big-font (font-spec :family "Fira Mono" :size 19))
)

(setq doom-theme 'doom-gruvbox)
;; TODO customise my own theme
;; TODO easy switch to light theme!

(setq auto-save-default t
      make-backup-files t
)

;; This determines the style of line numbers in effect. If set to `nil', line
;; numbers are disabled. For relative line numbers, set this to `relative'.
(setq display-line-numbers-type 'relative)

;; (setq doom-modeline-height 15)

;; (setq doom-modeline-major-mode-color-icon nil  ;; FIXME not working :(
;;        all-the-icons-color-icons nil)

;; (setq doom-modeline-height 1)
;; (set-face-attribute 'mode-line nil :family "Agave Nerd Font Mono" :height 100)
;;  (set-face-attribute 'mode-line-inactive nil :family "Noto Sans" :height 100)

(after! org

  (add-hook! 'org-mode-hook #'+org-pretty-mode #'mixed-pitch-mode)
  (add-hook! 'org-mode-hook 'org-num-mode) ; latex style numbered headings

  (setq org-directory "~/org/"        ; important emacs directory for this like agenda
        org-toggle-pretty-entities t  ; unicode/emoji rendering etc.
        org-num-skip-unnumbered t     ; skip `:UNNUMBERED:` from onumbering
        org-ellipsis " â–¼ "
        org-hide-emphasis-markers t
        global-org-pretty-table-mode t
        display-line-numbers-type 'nil
  )
)

  ;; (add-hook! 'org-mode-hook 'org-superstar-mode)  ; fancy unicode symbols (e.g headings)

(custom-set-faces!
  '(outline-1 :weight semi-bold      :height 1.12)
  '(outline-2 :weight semi-bold      :height 1.08)
  '(outline-3 :weight semi-bold      :height 1.05)
  '(outline-4 :weight semi-bold      :height 1.03)
  '(outline-5 :weight normal         :height 1.02)
  '(outline-6 :weight normal         :height 1.01)
  '(outline-7 :weight normal)
  '(outline-8 :weight normal)
  '(org-document-title :height 1.2))

;; (after! haskell-mode
;;  (set-ligatures! haskell-mode
;;  :lambda "\"
;;  )
;;)

(add-to-list 'auto-mode-alist '("\\.epub\\'" . nov-mode))

(add-to-list 'exec-path "path/to/sqlite3")

(setq org-roam-directory "~/org-roam")  ; set org-roam dir

(add-hook 'after-init-hook 'org-roam-mode) ; start on start-up

(setq org-roam-tag-sources '(prop vanilla all-directories))

(use-package! org-roam-bibtex
  :after org-roam
  :hook (org-roam-mode . org-roam-bibtex-mode)
  :config
  (require 'org-ref)) ; optional: if Org Ref is not loaded anywhere else, load it here


;; org-noter integration
(setq orb-preformat-keywords
   '(("citekey" . "=key=") "title" "url" "file" "author-or-editor" "keywords"))

;; Academic paper template
(setq orb-templates
      '(("r" "ref" plain (function org-roam-capture--get-point)
         ""
         :file-name "${citekey}"
         :head "#+TITLE: ${citekey}: ${title}\n#+ROAM_KEY: ${ref}

- keywords :: ${keywords}
 * ${title}
:PROPERTIES:
:Custom_ID: ${citekey}
:URL: ${url}
:AUTHOR: ${author-or-editor}
:NOTER_DOCUMENT: ${file}
:NOTER_PAGE:
:END:")))

(add-to-list 'org-latex-packages-alist '("" "natbib"))
(add-to-list 'org-latex-packages-alist '("" "cleveref"))

;; (setq org-format-latex-options
;;         (list :foreground 'default  ;;auto
;;               :background 'default
;;               :scale 1.5
;;               :html-foreground "Black"
;;               :html-background "Transparent"
;;               :html-scale 1.0
;;               :matchers '("begin" "$1" "$" "$$" "\\(" "\\[")))

(map! "C-q"  ; example
      (cmd! (previous-line)
            (kill-line)
            (forward-line)))

;; TODO natural window resizing

(setq lisp-indent-offset 2)

;; For GPG configuration, email clients, file templates and snippets.
(setq user-full-name "Nathan Sharp"
      user-mail-address "nasharp@outlook.com")
